#!/usr/bin/env bash
set -euo pipefail
trap 'echo "✖ Unexpected error on line $LINENO"; exit 1' ERR

#####################################
# Pre checks - never tested this sec
#####################################

# Color constants
RED="\033[1;31m"
CYAN="\033[1;36m"
RESET="\033[0m"

# Helpers
error() {
  echo -e "$*" >&2
  exit 1
}
info() {
  echo -e "→ $*"
}

# Usage
usage() {
  cat <<EOF
Usage: $(basename "$0")
Checks that a Fuseki catalog dataset is up at http://localhost:3030/catalog.
EOF
  exit 1
}
[[ "${1:-}" != "-h" ]] || usage

# Prerequisite
if ! command -v curl >/dev/null; then
  error "${RED}USER ACTION REQUIRED:${RESET} Install curl (e.g. brew install curl or apt-get install curl)."
fi


#####################################
# Actual script
#####################################
dateStr=$(date '+%y%m%d-%H%M')
output="./data/catalog-select-all.system-integration.gitignored.$dateStr.nt"
./scripts/.dev/task/task-extract-all-triples-to-file \
  -r http://localhost:5173/api/sparql/catalog/query \
  -o "$output";
  
# ./scripts/.dev/task/task-extract-all-triples-to-file \
#   -b "$COOKIE" \
#   -r https://apps.system-integration.telicent-sandbox.telicent.live/api/sparql/catalog/query \

raw_output="${output%.gitignored.nt}.gitignored.nt"
if [[ -f "$raw_output" ]]; then
  cat "$raw_output"
else
  cat "$output"
fi
